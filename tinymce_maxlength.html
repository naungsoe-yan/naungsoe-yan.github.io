<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Student Learning Space</title>
  <style>
    .rich-text-editor {
      border: 1px solid #ddd;
    }
    .rich-text-editor .editor-body {
      background-color: #fff;
      overflow-x: hidden;
      overflow-y: auto;
      max-height: 6rem;
      min-height: 3rem;
      outline: none;
    }
    .rich-text-editor .editor-body::before {
      margin: .5rem;
    }
    .rich-text-editor .editor-body p {
      margin: .5rem;
    }
    .rich-text-console {
      margin-top: 1rem;
      width: 100%;
      height: 8rem;
    }
  </style>
</head>
<body style="padding: 1rem 2rem; margin: auto; max-width: 800px;">
  <section>
    <h1 style="font-family: sans-serif;">RichText Editor</h1>
    <div id="editor" class="rich-text-editor">
      <div class="editor-toolbar"></div>
      <div class="editor-body">Existing content</div>
    </div>
    <textarea id="console" class="rich-text-console"></textarea>
  </section>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.3.2/tinymce.min.js" referrerpolicy="origin"></script>
  <script>
    const elements = Array.from(document.querySelectorAll('.rich-text-editor'));
    elements.forEach(element => {
      const editorId = element.getAttribute('id');
      tinymce.init({
        selector: `#${editorId} .editor-body`,
        fixed_toolbar_container: `#${editorId} .editor-toolbar`,
        contextmenu: false,
        contextmenu_never_use_native: false,
        plugins: 'print preview importcss searchreplace autolink autosave save directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime lists advlist wordcount imagetools textpattern noneditable help charmap emoticons',
        menubar: false,
        inline: true,
        toolbar_mode: 'sliding',
        toolbar: 'undo redo | bold italic underline strikethrough | forecolor backcolor | alignment numlist bullist | fontselect formatselect | attachment recording link media table drawing | maths science | website comment tooltip',
        mobile: {
           toolbar_mode: 'sliding',
           plugins: 'print preview importcss searchreplace autolink autosave save directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime lists advlist wordcount imagetools textpattern noneditable help charmap emoticons',
           toolbar: 'undo redo | bold italic underline strikethrough | forecolor backcolor | alignment numlist bullist | fontselect formatselect | attachment recording link media table drawing | maths science | website comment tooltip'
        },
        placeholder: 'Enter your answer here...',
        setup: (editor) => {
          const console = document.querySelector('#console');
          console.value += 'setup2\n';
          editor.on('keydown', function(event) {
            console.value += `keydown: ${event.keyCode}\n`;
            event.preventDefault();
            return false;
          });
          editor.on('input', function(event) {
            try {
              console.value +=  `input: ${event.target.value}\n`;
              const selection = window.getSelection();
              const anchorNode = selection.anchorNode;
              console.value +=  `anchor: ${anchorNode}\n`;
              const range = document.createRange();
              range.setStart(anchorNode, anchorNode.length - 1);
              range.setEnd(anchorNode, anchorNode.length);
              range.deleteContents();
            } catch(error) {
              console.value += `${error}n`;
            }
          });

          //alignleft aligncenter alignright alignjustify
          editor.ui.registry.addSplitButton('alignment', {
            icon: 'align-left',
            columns: 4,
            fetch: function (callback) {
              callback([
                { type: 'choiceitem', icon: 'align-left', value: 'left' },
                { type: 'choiceitem', icon: 'align-center', value: 'center' },
                { type: 'choiceitem', icon: 'align-right', value: 'right' },
                { type: 'choiceitem', icon: 'align-justify', value: 'justify' }
              ]);
            },
            onAction: function() {
              editor.execCommand('justifyLeft');
            },
            onItemAction: function(buttonApi, value) {
              const alignment = (value === 'justify') ? 'full' : value;
              editor.execCommand(`justify${alignment}`);
            },
            select: function(value) {
              const node = editor.selection.getNode();
              const parent = editor.dom.getParent(node, '[style*="text-align"]');
              return editor.dom.getStyle(parent, 'textAlign') === value;
            },
            onSetup: function(buttonApi) {
              const nodeChangeHandler = function(eventApi) {
                buttonApi.setActive(eventApi.parents.some(parent => {
                  return !!editor.dom.getStyle(parent, 'textAlign');
                }));
              };
              editor.on('NodeChange', nodeChangeHandler);
              return function () {
                return editor.off('NodeChange', nodeChangeHandler);
              };
            }
          });
          editor.ui.registry.addIcon('attachment', '<svg height="14pt" viewBox="-96 0 512 512" width="14pt" xmlns="http://www.w3.org/2000/svg"><path d="m160 512c-88.234375 0-160-71.765625-160-160v-224c0-11.796875 9.558594-21.332031 21.332031-21.332031 11.777344 0 21.335938 9.535156 21.335938 21.332031v224c0 64.683594 52.628906 117.332031 117.332031 117.332031s117.332031-52.648437 117.332031-117.332031v-234.667969c0-41.171875-33.492187-74.664062-74.664062-74.664062-41.175781 0-74.667969 33.492187-74.667969 74.664062v213.335938c0 17.640625 14.355469 32 32 32s32-14.359375 32-32v-202.667969c0-11.796875 9.558594-21.332031 21.332031-21.332031 11.777344 0 21.335938 9.535156 21.335938 21.332031v202.667969c0 41.171875-33.496094 74.664062-74.667969 74.664062s-74.667969-33.492187-74.667969-74.664062v-213.335938c0-64.679687 52.628907-117.332031 117.335938-117.332031 64.703125 0 117.332031 52.652344 117.332031 117.332031v234.667969c0 88.234375-71.765625 160-160 160zm0 0"/></svg>');
          editor.ui.registry.addMenuButton('attachment', {
            icon: 'attachment',
            fetch: function (callback) {
              callback([
                {
                  type: 'menuitem',
                  text: 'Upload file',
                  onAction: function () {}
                },
                {
                  type: 'menuitem',
                  text: 'Add from Library',
                  onAction: function () {}
                }
              ]);
            }
          });
          editor.ui.registry.addIcon('recording', '<svg enable-background="new 0 0 512 512" height="16pt" viewBox="0 0 512 512" width="16pt" xmlns="http://www.w3.org/2000/svg"><g><path d="m241 420.323v61.677h-90v30h210v-30h-90v-61.677c67.33-6.042 122.865-52.795 142.411-114.813l-28.612-9.018c-17.817 56.528-69.577 94.508-128.799 94.508s-110.982-37.98-128.799-94.509l-28.612 9.018c19.525 61.95 75.011 108.765 142.411 114.814z"/><path d="m256 361c57.897 0 105-47.103 105-105v-150c0-58.449-47.103-106-105-106s-105 47.551-105 106v150c0 57.897 47.103 105 105 105zm-75-180h45v-30h-45v-30h45v-30h-43.526c6.892-34.746 37.238-61 73.526-61s66.634 26.254 73.526 61h-43.526v30h45v30h-45v30h45v30h-150zm0 60h150v15c0 41.355-33.645 75-75 75s-75-33.645-75-75z"/></g></svg>');
          editor.ui.registry.addButton('recording', {
            icon: 'recording',
            onAction: function() {}
          });
          editor.ui.registry.addButton('drawing', {
            icon: 'color-picker',
            onAction: function() {}
          });
          editor.ui.registry.addIcon('maths', '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 300 261.7" style="enable-background:new 0 0 300 261.7;" xml:space="preserve"><g id="icon-wirisformula" stroke="none" stroke-width="1" fill-rule="evenodd"><g><path class="st1" d="M90.2,257.7c-11.4,0-21.9-6.4-27-16.7l-60-119.9c-7.5-14.9-1.4-33.1,13.5-40.5c14.9-7.5,33.1-1.4,40.5,13.5l27.3,54.7L121.1,39c5.3-15.8,22.4-24.4,38.2-19.1c15.8,5.3,24.4,22.4,19.1,38.2l-59.6,179c-3.9,11.6-14.3,19.7-26.5,20.6C91.6,257.7,90.9,257.7,90.2,257.7"></path></g></g><g><g><path class="st2" d="M300,32.8c0-16.4-13.4-29.7-29.9-29.7c-2.9,0-7.2,0.8-7.2,0.8c-37.9,9.1-71.3,14-112,14c-0.3,0-0.6,0-1,0c-16.5,0-29.9,13.3-29.9,29.7c0,16.4,13.4,29.7,29.9,29.7l0,0c45.3,0,83.1-5.3,125.3-15.3h0C289.3,59.5,300,47.4,300,32.8"></path></g></g></svg>');
          editor.ui.registry.addButton('maths', {
            icon: 'maths',
            onAction: function() {}
          });
          editor.ui.registry.addIcon('science', '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">  <image id="image0" width="16" height="16" x="0" y="0" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfiChwSIwERK9BGAAABfklEQVQoz12RvUtbcRiFn/uRXKNJNCJSokFFqoKDIjHEqKA4WRAc/AsUKl2Ck5ODIKKDm4v+BbqIEr8WQ+hgQSgOElGJgkPTih+3tUabeL3353A1CX3Hcx7OC+dIAIL3CwXEmJU6XBHWuyIVgIjrOcoUblCTrolE/D+gc0QsUJePEtrGh+jajzcg1GQu0W87ldl7zZQAtPP9Dh5lADNm25rx+Xb7ZdWMCAARyHXhVQD8iwAD+qLV61B++U4Hb5pKS9Tx3w05Umr+K3Mlsk6SfY7x9oX7OvDiwlEEoLPLNkdc4yRJG9WkuCoCxBV7JMhg8cgRl7h44m9xwhM3PLyVYnBni3LBX64p4MHGYLSzOV9UWDd8AO608iW+2eP5NyVN4JR/7rRU2T0MzVRmATI197FIInsmTeIErcwTxqcAxHPDFdLHE4cJmPV4AAKZ+XStyrkCMC00K8Qnj+6+kAFKjfE/sw6/zAXf7bFUqmill+5v7es+vzVqlhukOWCLr6/ZMH/PRaOKYwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0xMC0yOVQwMTozNTowMS0wNzowMOC+eEAAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMTAtMjlUMDE6MzU6MDEtMDc6MDCR48D8AAAAAElFTkSuQmCC"></image></svg>');
          editor.ui.registry.addButton('science', {
            icon: 'science',
            onAction: function() {}
          });
          editor.ui.registry.addButton('website', {
            icon: 'embed-page',
            onAction: function() {}
          });
          editor.ui.registry.addButton('comment', {
            icon: 'comment',
            onAction: function() {}
          });
          editor.ui.registry.addButton('tooltip', {
            text: 'Tooltip',
            onAction: function() {}
          });
        }
      });
    });
  </script>
</body>
</html>